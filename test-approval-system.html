<!DOCTYPE html>
<html>
<head>
    <title>Approval System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>KAALCAL26 Approval System Test</h1>
    
    <div class="test-section">
        <h2>Test Email Sending</h2>
        <button onclick="testApprovalEmail()">Test Approval Email</button>
        <button onclick="testRejectionEmail()">Test Rejection Email</button>
        <div id="emailResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test Application Storage</h2>
        <button onclick="checkApplications()">Check Stored Applications</button>
        <button onclick="addTestApplication()">Add Test Application</button>
        <div id="appResult" class="result"></div>
    </div>
    
    <script>
        // Test application data
        const testApplication = {
            id: 'test_' + Date.now(),
            type: 'delegate',
            fullName: 'Test User',
            email: 'test@example.com',
            phone: '+905321234567',
            status: 'pending',
            createdAt: new Date().toISOString()
        };
        
        async function testApprovalEmail() {
            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: testApplication.email,
                        name: testApplication.fullName,
                        applicationType: 'Delege Ba≈üvurusu',
                        applicationId: testApplication.id,
                        status: 'approved'
                    })
                });
                
                const result = await response.json();
                document.getElementById('emailResult').innerHTML = `
                    <div class="success">‚úÖ Approval Email Test: ${result.success ? 'Success' : 'Failed'}</div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('emailResult').innerHTML = `
                    <div class="error">‚ùå Approval Email Test: Error</div>
                    <p>${error.message}</p>
                `;
            }
        }
        
        async function testRejectionEmail() {
            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: testApplication.email,
                        name: testApplication.fullName,
                        applicationType: 'Delege Ba≈üvurusu',
                        applicationId: testApplication.id,
                        status: 'rejected'
                    })
                });
                
                const result = await response.json();
                document.getElementById('emailResult').innerHTML = `
                    <div class="success">‚úÖ Rejection Email Test: ${result.success ? 'Success' : 'Failed'}</div>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('emailResult').innerHTML = `
                    <div class="error">‚ùå Rejection Email Test: Error</div>
                    <p>${error.message}</p>
                `;
            }
        }
        
        function checkApplications() {
            const applications = JSON.parse(localStorage.getItem('kaalcal_applications') || '[]');
            document.getElementById('appResult').innerHTML = `
                <div class="success">üìä Stored Applications: ${applications.length}</div>
                <pre>${JSON.stringify(applications, null, 2)}</pre>
            `;
        }
        
        function addTestApplication() {
            const applications = JSON.parse(localStorage.getItem('kaalcal_applications') || '[]');
            applications.push(testApplication);
            localStorage.setItem('kaalcal_applications', JSON.stringify(applications));
            document.getElementById('appResult').innerHTML = `
                <div class="success">‚úÖ Test Application Added</div>
                <p>ID: ${testApplication.id}</p>
                <p>Name: ${testApplication.fullName}</p>
                <p>Email: ${testApplication.email}</p>
            `;
        }
        
        // Check initial state
        checkApplications();
    </script>
</body>
</html>
